<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <script src="scripts/jquery-1.11.2.js"></script>
    <script src="scripts/bootstrap.js"></script>
    <script src="scripts/knockout-3.2.0.js"></script>
    <script src="scripts/knockout.mapping-latest.js"></script>
    <script src="scripts/Site.js"></script>
    <link href="css/bootstrap.css" rel="stylesheet" />
    <link href="css/bootstrap-theme.css" rel="stylesheet" />
    <link href="Site.css" rel="stylesheet" />
    <title>Animal List</title>
</head>
<body>
    <form method="post" action="petlistko" id="form1">
    <div>
        
     <div style="margin-left:40px;">
        <h1>Pet List</h1>
        <div id="divTest1">
            <table class="table table-striped table-bordered table-condensed" style="width:600px;">
                <tr><td><a href="AnimalEdit.html?id=0">Add a Record</a></td></tr>
                <thead id="tblHead">
                    <tr>
                        <th>Pet Name</th>
                        <th>Type</th>
                        <th>Breed</th>
                        <th>Color</th>
                        <th>Weight</th>
                    </tr>
                </thead>
                <tbody id="tblBody" data-bind="foreach: items">
                    <tr>
                        <td><a data-bind="text: petname, attr: { href: 'AnimalEdit.html?id=' + petid() }" /></td>
                        <td data-bind="text: pettype"></td>
                        <td data-bind="text: breed"></td>
                        <td data-bind="text: color"></td>
                        <td data-bind="text: weight"></td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

        <script type="text/javascript">
            // MSI developer code
            var devCode = "9ofioftnebd1xr7k0nnwcwwt4st3pbpb";
            // MSI API root URL
            var MSIRootAPI = "https://msitest.azurewebsites.net/dapi/9ofioftnebd1xr7k0nnwcwwt4st3pbpb/";

            jQuery(document).ready(function () {
                InitializeViewModel();
                getData();
            });

            function InitializeViewModel() {
                dataModel = new dataModel();
                ko.applyBindings(dataModel);
            }

            // main model
            function dataModel(n) {
                var self = this;
                self.items = ko.observableArray([]);
                self.pageSize = ko.observable(5);
                self.columns = ko.observableArray([]);
                self.count = 0;
            }

            function viewModel(rec) {
                var self = this;
                self.petid = ko.observable(rec.petid);
                self.pettype = ko.observable(rec.pettype);
                self.petname = ko.observable(rec.petname);
                self.breed = ko.observable(rec.breed);
                self.color = ko.observable(rec.color);
                self.weight = ko.observable(rec.weight);
            }

            function getData() {
                var jqxhr = $.get(MSIRootAPI + "pets", "", function (response) {
                    getDataResponse(response);
                }, "json")
                .fail(function (response) {
                    RequestFailed(response);
                }
                );
            }

            function RequestFailed(r) {
                alert("data request failed");
            }

            // load view model so Knockout can bind to it
            function getDataResponse(response) {
                dataModel.count = response.length;
                for (i = 0; i < response.length; i++) {
                    var vm = new viewModel(response[i]);
                    dataModel.items.push(vm);
                }
            }
        </script>

    </div>
    </form>
    <footer class="footer"> <p>Except as otherwise noted, the content of this page is licensed under the <br />
       Creative Commons Attribution 3.0 License and the Apache 2.0 License. See Site Policies for details.
</p></footer>
</body>
</html>
